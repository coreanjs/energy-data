{
  "hash": "5425f1ceecb66193786e6296723dd400",
  "result": {
    "markdown": "---\ntitle: \"KIER기술정책플랫폼\"\ndate : last-modified # now\nauthor: \n - name: \"안지석\"\n   affiliation: \"한국에너지기술연구원 정책연구실\"\ntitle-block-banner: false\nformat: \n  html:\n    theme: flatly\n    code-fold: false\n    toc: true\n    toc-depth: 2\n    toc-title: 목차\n    number-sections : true\n    highlight-style: github\n    self-contained: false\nlink-citation: true\ncsl: apa-single-spaced.csl\nreference-location: margin\nexecute:\n  echo: true\n  warning: false\n  \nfreeze: true\n---\n\n\n# 통계청 소비자물가지수를 활용한 분석\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(lubridate)\nlibrary(zoo)\nlibrary(showtext)\nlibrary(extrafont)\n\nshowtext_auto()\n\nfont_add_google(\"Nanum Gothic\", \"nanumgothic\")\nfont_add_google(\"Poor Story\", \"poorstory\")\n\n\n#R 버전 알려주는 코드 \nR.version\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               _                                \nplatform       x86_64-w64-mingw32               \narch           x86_64                           \nos             mingw32                          \ncrt            ucrt                             \nsystem         x86_64, mingw32                  \nstatus                                          \nmajor          4                                \nminor          3.1                              \nyear           2023                             \nmonth          06                               \nday            16                               \nsvn rev        84548                            \nlanguage       R                                \nversion.string R version 4.3.1 (2023-06-16 ucrt)\nnickname       Beagle Scouts                    \n```\n:::\n\n```{.r .cell-code}\nprice_raw <- read_excel(\"230821_생활물가지수.xlsx\", sheet =\"Sheet1\")\n\n\nunique(price_raw$type)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"총지수\"     \"커피(외식)\" \"소주(외식)\" \"맥주(외식)\" \"전기료\"    \n [6] \"도시가스\"   \"휘발유\"     \"경유\"       \"시내버스료\" \"택시료\"    \n```\n:::\n\n```{.r .cell-code}\nprice_tidy<- price_raw %>% \n  pivot_longer(-type, values_to =\"value\", names_to = \"date\") %>% \n  mutate(date = zoo::as.yearmon(date, \"%Y.%m\"),\n         color_label = case_when(type =='경유'~ type,\n                                 type ==\"도시가스\" ~ type,\n                                 TRUE ~ '기타'))\n\nrange(price_tidy$date)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"1 2014\" \"7 2023\"\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nprice_img <- price_tidy %>% \n  ggplot() +\n  geom_line(data =. %>% filter(!type %in% c(\"도시가스\", \"경유\")), aes(x = date, y = value, group = type), linewidth = 1.2,  color =\"gray\")+\n  geom_line(data =. %>% filter(type ==\"경유\"), aes(x = date, y = value), linewidth = 1.5,  color =\"red\")+\n  geom_line(data =. %>% filter(type ==\"도시가스\"), aes(x = date, y = value), linewidth = 1.5,  color =\"blue\")+\n    theme_bw()+\n  theme_minimal()+\n  theme(plot.title = element_text(family=\"nanumgothic\"))+\n  labs(title =\"물가지수에서 경유와 도시가스만 표기\",\n       subtitle =\"물가지수에서 에너지가 차지하는 정도를 보기 위해 만들었다\")\n\nprice_img\n```\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-2-1.png){width=80%}\n:::\n:::\n\n\n![](경유와%20휘발유.png)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(zoo)\nlibrary(ggtext)\nprice_tidy %>% \n  #ggplot(aes(x = date, y = value, group = type, color = color_label))+\n  ggplot() +\n  geom_line(data =. %>% filter(!type %in% c(\n    #\"도시가스\", \n    #\"경유\", \n    #\"휘발유\"\n    \"전기료\"\n  )), \n  aes(x = date, y = value, group = type), size = 1.5,  color =\"gray\")+\n  geom_line(data =. %>% filter(type ==\"전기료\"), aes(x = date, y = value), size = 2,  color =\"#f7c93a\")+\n  #geom_line(data =. %>% filter(type ==\"전기료\"), aes(x = date, y = value), size = 1.5,  color =\"brown\")+\n  #scale_x_date(date_breaks = \"1 year\", date_labels =paste0(\"'\", \"%y\"))+\n  theme_bw()+\n  scale_y_continuous(limits = c(0, 200))+\n  theme_minimal()+\n  theme(plot.title = element_text(size = 24, family=\"nanumgothic\"),\n        plot.subtitle =element_markdown(size = 20),\n        plot.background =element_rect(fill=\"white\"),\n        panel.grid.minor = element_blank(),\n        panel.grid.major.x =element_blank())+\n  labs(y = \"물가지수\",\n       x ='연도',\n       title =\"통계청 생활물가지수를 통해서 보는 에너지 물가\",\n       subtitle =\"물가지수에서 <span style = 'color:#f7c93a;'>전기료</span>만 표기\",\n       caption = \"Source: 통계청, Graphic: Jiseok\")\n```\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gghighlight)\nprice_tidy %>% \n  #ggplot(aes(x = date, y = value, group = type, color = color_label))+\n  ggplot(aes(x = date, y = value, group = type)) +\n  geom_line(linewidth = 1.2, color ='#f4481a')+\n  gghighlight()+\n  #scale_x_date(date_breaks = \"1 year\", date_labels =paste0(\"'\", \"%y\"))+\n  theme_bw()+\n  theme_minimal()+\n  facet_wrap(~type)+\n  theme(plot.title = element_text(size = 24, family=\"nanumgothic\"),\n        plot.background =element_rect(fill=\"white\"),\n        panel.grid.minor = element_blank(),\n        panel.grid.major.x =element_blank())+\n  labs(title =\"물가지수\",\n       subtitle =\"물가지수에서 에너지가 차지하는 정도를 보기 위해 만들었다\",\n       caption = \"Source: 통계청, Graphic: Jiseok\")\n```\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n-   주어진 10개의 물가지수 중 어떤 걸 강조할 것인지 - 스토리텔링\n-   도시가스? 전기료? 휘발유? 경유?\n\n참고 유튜브\n\n[Applying concepts from Storytelling with Data in R using ggplot2](https://youtu.be/rkQREY_FfqI?si=e9PxnzjNstY6CjVY)\n\n# 암모니아 수용성 분석\n\n-   목적: 암모니아 수용성 분석 결과 시각화\n-   주요 내용\n    -   암모니아의 폭발, 독성, 냄새에 대한 일반 국민의 수용성 분석\n    -   일반 국민의 개인 특성에 따른 수용성 분석\n\n# R&D 프로젝트의 위험 요인과 위험 관리 전략 분석\n\n-   목적: 네트워크 분석을 통해 R&D 프로젝트의 위험 요인 간 상관관계와 위험 관리 전략 분석\n\n# 신재생에너지 잠재량 Vs 신재생에너지 발전량\n\n-   태양광 중심의 신재생에너지 잠재량 대비 신재생에너지 발전량을 비교하여 지도 형태로 제시\n-   신재생빅데이터연구실의 신재생에너지 기술적 잠재량과 한국에너지공단 신재생에너지센터 보급통계 발전량을 활용\n-   잠재량은 높으나 보급통계 발전량이 낮을 경우 기술적, 정책적 해결책 제시 등으로 발전(가능하다면...)\n\n# 텍스트 마이닝을 활용한 정권별 에너지정책 이슈 분석\n\n-   에너지정책 관련 언론보도 분석을 통해 에너지정책 분야 주요 이슈의 특징, 경향, 변화 방향 분석\n-   키워드 동시출현 빈도 네트워크, 키워드 간 상관관계 네트워크 분석 등 수행\n\n## 사전 설치\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(KoNLP)\nuseNIADic()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nBackup was just finished!\n1213109 words dictionary was built.\n```\n:::\n\n```{.r .cell-code}\nuseSejongDic()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nBackup was just finished!\n370957 words dictionary was built.\n```\n:::\n:::\n\n\n## 전처리\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsetwd(\"C:/R/Rproject/Energy&Data/20230838_Energy_Issues_Bigkinds\")\n\nnews.raw<- read_excel(\"climate change.xlsx\")\n\nstr(news.raw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ntibble [3,116 × 19] (S3: tbl_df/tbl/data.frame)\n $ 뉴스 식별자                 : chr [1:3116] \"01300201.20230710000350002\" \"01500901.20230709205904001\" \"01400201.20230706182057001\" \"02100501.20230705185436001\" ...\n $ 일자                        : chr [1:3116] \"20230710\" \"20230709\" \"20230706\" \"20230705\" ...\n $ 언론사                      : chr [1:3116] \"강원일보\" \"울산매일\" \"대전일보\" \"파이낸셜뉴스\" ...\n $ 기고자                      : chr [1:3116] NA \"울산매일\" NA NA ...\n $ 제목                        : chr [1:3116] \"[사설]이번 주 내내 ‘비’, 재난 대응에 빈틈없어야 한다\" \"[사설] 해수 온도 최고치, 기후변화 대응 방법 달리해야\" \"[사설] '기회발전특구', 충남 발전 동력으로 삼아야\" \"[테헤란로] 원전 늘려도 본전도 못 찾는 RE100\" ...\n $ 통합 분류1                  : chr [1:3116] \"사회>사회일반\" \"사회>사회일반\" \"지역>충남\" \"경제>자원\" ...\n $ 통합 분류2                  : chr [1:3116] \"경제>경제일반\" NA \"지역>강원\" \"경제>산업_기업\" ...\n $ 통합 분류3                  : chr [1:3116] NA NA \"지역>전남\" \"경제>반도체\" ...\n $ 사건/사고 분류1             : chr [1:3116] \"사고>산업사고>붕괴\" \"재해>자연재해>태풍\" NA NA ...\n $ 사건/사고 분류2             : chr [1:3116] \"재해>자연재해>눈사태_산사태\" NA NA NA ...\n $ 사건/사고 분류3             : chr [1:3116] \"재해>자연재해>해일\" NA NA NA ...\n $ 인물                        : chr [1:3116] NA NA NA \"김동호\" ...\n $ 위치                        : chr [1:3116] \"수해,영서지역,강원,수도권\" \"울산,동해면,울산지역,러시아,북극\" \"국가산업단지,충남,혁신도시,충남도,수도권\" \"국가산업단지,용인,초미,전경련\" ...\n $ 기관                        : chr [1:3116] \"기상청\" \"울산,북극해,한국해양과학기술원,동해\" \"정부,산업자원부,충남,지방분권,지방시대위원회,지방시,수도권,충남도\" \"재생에너지,정부,현대차,중국,산업부,SK,LG,삼성전자,삼성\" ...\n $ 키워드                      : chr [1:3116] \"재난,대응,도내,내륙,산지,중심,9일,시간당,수도권,강원,영서,지역,11일,16일,예보,기상청,장마,시작,지난달,전국,피해\"| __truncated__ \"최고치,해수,온도,최고,방법,기후,변화,대응,울산,인근,바다,환경,급속,사실,통계,확인,한국해양과학기술원,3월,5월,봄\"| __truncated__ \"기회발전특구,동력,충남,발전,충남,기회,발전,특구,설명회,사진,충남도,지방시대위원회,제공,이달,지방,시대,위원회,출\"| __truncated__ \"원전,본전,RE100,원전,RE100,신재생에너지,사용,전력,100%,포함,기업,가입,RE100,달성,RE100,가시밭길,예고,문구,기후\"| __truncated__ ...\n $ 특성추출(가중치순 상위 50개): chr [1:3116] \"산사태,만큼,농작물,시설물,강원,그동안,기후변화,시간당,수도권,여름철,양수기,자연재해,지자체,집중호우,기상청,고정\"| __truncated__ \"봄철,울산,기후변화,여름철,러시아,우리나라,동해면,한국해양과학기술원,자릿수\" \"기회발전특구,충남,지자체,충남도,지방시대위원회,만큼,설명회,위원회,수도권,지방소멸,지역균형발전\" \"re100,재생에너지,전력량,삼성,발전량,cf100,반도체,보고서,공급망,신재생에너지,산업부,용인,김동호,태양광,기업들,신한울1호\" ...\n $ 본문                        : chr [1:3116] \"도내 내륙과 산지를 중심으로 9일부터 시간당 30㎜ 이상 강한 비가 쏟아진 데 이어 수도권과 강원 영서지역에 11일부터\"| __truncated__ \"최근 울산 인근 바다 환경이 급속하게 변하고 있다는 사실이 통계로 확인됐다. 한국해양과학기술원이 지난 3월부터 5월\"| __truncated__ \"충남도 기회발전특구 설명회. 사진=충남도 제공 이달 지방시대위원회의 출범을 앞두고 국가 균형발전 정책의 핵심인 기\"| __truncated__ \"'원전은 RE100(신재생에너지 전력 100% 사용)에 포함되지 않는다.' 국내 32개 기업이 가입한 RE100 목표 달성까지 가시\"| __truncated__ ...\n $ URL                         : chr [1:3116] \"https://www.kwnews.co.kr/page/view/2023070916212101810\" \"http://www.iusm.co.kr/news/articleView.html?idxno=1018957\" \"http://www.daejonilbo.com/news/articleView.html?idxno=2073302\" \"http://www.fnnews.com/news/202307051852295130\" ...\n $ 분석제외 여부               : chr [1:3116] NA NA NA NA ...\n```\n:::\n\n```{.r .cell-code}\nnews.selected<- news.raw %>% \n    select(일자, 언론사, `특성추출(가중치순 상위 50개)`) %>% \n    #  mutate(키워드 = str_replace_all(키워드, ',', ' ')) %>% \n    rename(keyword = `특성추출(가중치순 상위 50개)`,\n           date = 일자,\n           source = 언론사) %>% \n    mutate(date = as.Date(date, format=\"%Y%m%d\"),\n           president = case_when(date >= as.Date('2008-02-05') & date <= as.Date('2013-02-24') ~ '이명박',\n                                 date >= as.Date('2013-02-25') & date <= as.Date('2017-03-10')~ '박근혜',\n                                 date >= as.Date('2017-05-10') & date <= as.Date('2022-05-09') ~ '문재인',\n                                 date >= as.Date('2022-05-10')  ~ '윤석열'),\n           president = factor(president, levels = c('이명박', '박근혜', '문재인', '윤석열')))\n\n\nnews.selected\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3,116 × 4\n   date       source       keyword                                     president\n   <date>     <chr>        <chr>                                       <fct>    \n 1 2023-07-10 강원일보     산사태,만큼,농작물,시설물,강원,그동안,기후… 윤석열   \n 2 2023-07-09 울산매일     봄철,울산,기후변화,여름철,러시아,우리나라,… 윤석열   \n 3 2023-07-06 대전일보     기회발전특구,충남,지자체,충남도,지방시대위… 윤석열   \n 4 2023-07-05 파이낸셜뉴스 re100,재생에너지,전력량,삼성,발전량,cf100,… 윤석열   \n 5 2023-07-04 전남일보     석곡천,광주,강물,재보수,주민들,흙벽,광주시… 윤석열   \n 6 2023-07-04 서울경제     태양광,지원금,생태계,신재생,배출량,문재인,… 윤석열   \n 7 2023-07-04 중앙일보     태양광,신재생,만큼,전기료,계산서,보조금,발… 윤석열   \n 8 2023-07-04 동아일보     태양광,신재생,사업비,부패예방추진단,계산서… 윤석열   \n 9 2023-07-04 국제신문     오사카,일본,부산,시의회,예카테린부르크,가…  윤석열   \n10 2023-07-02 경향신문     노동자,온열질환,여름철,주차장,열사병,작업…  윤석열   \n# ℹ 3,106 more rows\n```\n:::\n\n```{.r .cell-code}\n## complete.cases를 활용해 결측행만 보기 박근혜 탄핵 후 - 문재인 임명 전까지는 NA\n\nnews.selected[!complete.cases(news.selected),]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 14 × 4\n   date       source       keyword                                     president\n   <date>     <chr>        <chr>                                       <fct>    \n 1 2017-05-08 경상일보     울산,이상기후,차바,내습시,한국수자원공사,…  <NA>     \n 2 2017-04-18 충청투데이   기상과학관,과학관,충남,미세먼지,충남기상과… <NA>     \n 3 2017-04-05 강원일보     강수량,물부족,대비책,저수율,영동,영동지역,… <NA>     \n 4 2017-03-30 경향신문     미국,오바마,기후변화,배출량,평균기온,일자…  <NA>     \n 5 2017-03-30 한국경제     파리협정,오바마,천연가스,행정명령,온실가스… <NA>     \n 6 2017-03-24 강원일보     우리나라,강원,강원남,강원도,평창,효용성,성… <NA>     \n 7 2017-03-23 강원일보     뒤마,프랑스,우리나라,철학자,로베르,yonghs,… <NA>     \n 8 2017-03-23 경남신문     농작물재해보험,자연재해,보험료,시군,보험가… <NA>     \n 9 2017-03-22 광주매일신문 광주,지속가능발전,지속가능,광주시,일자리,…  <NA>     \n10 2017-03-21 울산매일     빗물,울산,만큼,어린이집,활성화,70억,울산시… <NA>     \n11 2017-03-20 국제신문     부산시,부산,un,아시아,중요성,낙동강,미래도… <NA>     \n12 2017-03-17 한국경제     예산안,공무원,행정부,보조금,포퓰리즘,epa,…  <NA>     \n13 2017-03-16 울산매일     울산,시민들,산업단지,불안감,울산시,지자체,… <NA>     \n14 2017-03-15 한국경제     통계청,경제성장,소속감,복지예산,브라질,지…  <NA>     \n```\n:::\n\n```{.r .cell-code}\n## complete.cases를 활용해 박근혜와 문재인 사이 빈 기간 날리기\n\nnews.selected <- news.selected %>% filter(complete.cases(news.selected))\n\n\n\nhead(news.selected)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 4\n  date       source       keyword                                      president\n  <date>     <chr>        <chr>                                        <fct>    \n1 2023-07-10 강원일보     산사태,만큼,농작물,시설물,강원,그동안,기후…  윤석열   \n2 2023-07-09 울산매일     봄철,울산,기후변화,여름철,러시아,우리나라,…  윤석열   \n3 2023-07-06 대전일보     기회발전특구,충남,지자체,충남도,지방시대위…  윤석열   \n4 2023-07-05 파이낸셜뉴스 re100,재생에너지,전력량,삼성,발전량,cf100,…  윤석열   \n5 2023-07-04 전남일보     석곡천,광주,강물,재보수,주민들,흙벽,광주시,… 윤석열   \n6 2023-07-04 서울경제     태양광,지원금,생태계,신재생,배출량,문재인,…  윤석열   \n```\n:::\n\n```{.r .cell-code}\ntail(news.selected)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 4\n  date       source     keyword                                        president\n  <date>     <chr>      <chr>                                          <fct>    \n1 2008-03-18 아시아경제 지식경제부,위원회,외국인,이명박,중소기업,구미… 이명박   \n2 2008-03-17 한국경제   고유가,자주개발률,산자부,유연탄,자원난,중국,…  이명박   \n3 2008-03-17 한라일보   기후변화,제주,컨트롤타워,수산업,지자체,先占,…  이명박   \n4 2008-03-11 제민일보   기후변화,적응대책,활엽수림,류성필,영국,우리나… 이명박   \n5 2008-03-10 제민일보   제주,이산화탄소,제주환경,기후변화,느티나무,화… 이명박   \n6 2008-02-29 제민일보   제주,신성장동력산업,문화콘텐츠,제주도,가능성,… 이명박   \n```\n:::\n\n```{.r .cell-code}\n## 몇개의 사설??\nnrow(news.selected)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 3102\n```\n:::\n\n```{.r .cell-code}\nnews.selected %>% \n    group_by(president) %>% \n    count(n = n()) %>%\n    ungroup() %>% \n    mutate(pct = nn/n*100)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 4\n  president     n    nn   pct\n  <fct>     <int> <int> <dbl>\n1 이명박     3102   989  31.9\n2 박근혜     3102   518  16.7\n3 문재인     3102  1134  36.6\n4 윤석열     3102   461  14.9\n```\n:::\n\n```{.r .cell-code}\n### 월별로 정리해서 보기 - 모든 기간\nnews.selected %>% \n    mutate(ym = as.yearmon(date)) %>% \n    group_by(ym, president) %>% \n    count( n = n()) %>% \n    ggplot(aes(x = as.Date(ym), y = nn))+\n    geom_col(fill =\"#1f5c99\")+\n    scale_x_date(date_breaks = \"1 year\", date_labels = \"'%y. %b.\")+ \n    geom_vline(xintercept = as.Date('2008-02-05'), color =\"red\", linetype =\"dashed\")+\n    geom_vline(xintercept = as.Date('2013-02-25'), color =\"red\", linetype =\"dashed\")+\n    geom_vline(xintercept = as.Date('2017-05-10'), color =\"red\", linetype =\"dashed\")+\n    geom_vline(xintercept = as.Date('2022-05-10'), color =\"red\", linetype =\"dashed\")+\n    theme(\n        text = element_text(family = 'Nanum Myeongjo'),\n        panel.grid.minor.x = element_blank(),\n        #panel.grid.major.x = element_blank(),\n        #    panel.grid.major.y = element_blank(),\n        #axis.text.x = element_blank(),\n        axis.text.y = element_text(size = 15),\n        axis.ticks.x = element_blank(),\n        strip.text.x = element_text(size = 11),\n        legend.position = \"none\")+\n    labs(y = '사설 수',\n         x = '날짜')\n```\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\nnews.selected %>% \n    mutate(ym = as.yearmon(date)) %>% \n    group_by(ym, president) %>% \n    count( n = n()) %>% \n    ggplot(aes(x = as.Date(ym), y = nn))+\n    geom_col(fill =\"#1f5c99\")+\n    scale_x_date(date_breaks = \"1 year\", date_labels = \"'%y. %b.\")+ facet_wrap(~president, ncol = 1)+\n    \n    theme(\n        text = element_text(family = 'Nanum Myeongjo'),\n        panel.grid.minor.x = element_blank(),\n        #panel.grid.major.x = element_blank(),\n        #    panel.grid.major.y = element_blank(),\n        #axis.text.x = element_blank(),\n        axis.text.y = element_text(size = 12),\n        axis.ticks.x = element_blank(),\n        strip.text.x = element_text(size = 11),\n        legend.position = \"none\")+\n    labs(y = '사설 수',\n         x = '날짜')+\n    geom_smooth(color =\"yellow\")\n```\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidytext)\n\n\n\nnews.selected\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3,102 × 4\n   date       source       keyword                                     president\n   <date>     <chr>        <chr>                                       <fct>    \n 1 2023-07-10 강원일보     산사태,만큼,농작물,시설물,강원,그동안,기후… 윤석열   \n 2 2023-07-09 울산매일     봄철,울산,기후변화,여름철,러시아,우리나라,… 윤석열   \n 3 2023-07-06 대전일보     기회발전특구,충남,지자체,충남도,지방시대위… 윤석열   \n 4 2023-07-05 파이낸셜뉴스 re100,재생에너지,전력량,삼성,발전량,cf100,… 윤석열   \n 5 2023-07-04 전남일보     석곡천,광주,강물,재보수,주민들,흙벽,광주시… 윤석열   \n 6 2023-07-04 서울경제     태양광,지원금,생태계,신재생,배출량,문재인,… 윤석열   \n 7 2023-07-04 중앙일보     태양광,신재생,만큼,전기료,계산서,보조금,발… 윤석열   \n 8 2023-07-04 동아일보     태양광,신재생,사업비,부패예방추진단,계산서… 윤석열   \n 9 2023-07-04 국제신문     오사카,일본,부산,시의회,예카테린부르크,가…  윤석열   \n10 2023-07-02 경향신문     노동자,온열질환,여름철,주차장,열사병,작업…  윤석열   \n# ℹ 3,092 more rows\n```\n:::\n\n```{.r .cell-code}\nnews.selected %>% \n    select(keyword) %>% \n    separate_rows(keyword, sep= \",\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 66,017 × 1\n   keyword \n   <chr>   \n 1 산사태  \n 2 만큼    \n 3 농작물  \n 4 시설물  \n 5 강원    \n 6 그동안  \n 7 기후변화\n 8 시간당  \n 9 수도권  \n10 여름철  \n# ℹ 66,007 more rows\n```\n:::\n\n```{.r .cell-code}\nnews.keyword<- news.selected %>% \n    separate_rows(keyword, sep= \",\") %>% \n    rename(word = keyword) %>% \n    filter(str_length(word) > 1) %>% \n    count(president, word, sort = TRUE) %>%\n    filter(!word %in% c('만큼', '그동안', '각국'))\n\n\nnews.keyword\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 25,607 × 3\n   president word         n\n   <fct>     <chr>    <int>\n 1 이명박    기후변화   542\n 2 박근혜    기후변화   309\n 3 문재인    기후변화   304\n 4 문재인    탄소중립   283\n 5 문재인    미국       250\n 6 문재인    한국       249\n 7 이명박    미국       232\n 8 문재인    탈원전     225\n 9 이명박    우리나라   204\n10 이명박    한국       199\n# ℹ 25,597 more rows\n```\n:::\n\n```{.r .cell-code}\n## slice 활용해서 상위 n개만 보기\nnews.keyword %>% \n    group_by(president) %>%\n    mutate(row_number = row_number(),\n           word = reorder_within(word, n, president)) %>% \n    slice(1:20) %>% \n    ggplot(aes(x = word, y = n))+\n    geom_col(fill =\"#1f5c99\")+\n    coord_flip()+\n    scale_x_reordered()+\n    facet_wrap(~president, scales = \"free_y\", nrow = 1)+\n    theme(\n        text = element_text(family = 'Nanum Myeongjo'),\n        panel.grid.minor.x = element_blank(),\n        #panel.grid.major.x = element_blank(),\n        #    panel.grid.major.y = element_blank(),\n        #axis.text.x = element_blank(),\n        axis.text.y = element_text(size = 12),\n        axis.ticks.x = element_blank(),\n        strip.text.x = element_text(size = 11),\n        legend.position = \"none\")+\n    labs(y = '사설 수',\n         x = '날짜')\n```\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\nnews.keyword %>% \n    group_by(word) %>% \n    summarise(n = sum(n)) %>% \n    top_n(20) %>% \n    ggplot(aes(x = reorder(word, n), y = n))+\n    geom_col(fill =\"#1f5c99\")+\n    coord_flip()+\n    theme(\n        text = element_text(family = 'Nanum Myeongjo'),\n        panel.grid.minor.x = element_blank(),\n        #panel.grid.major.x = element_blank(),\n        #    panel.grid.major.y = element_blank(),\n        #axis.text.x = element_blank(),\n        axis.text.y = element_text(size = 15),\n        axis.ticks.x = element_blank(),\n        strip.text.x = element_text(size = 11),\n        legend.position = \"none\")+\n    labs(y = '단어 수',\n         x = '단어')\n```\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n:::\n\n\n## 특정 키워드만 ('미국) 보기 - 미국이 들어간 컬럼만 보기\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnews.selected %>% \n    mutate(keyword_detect = ifelse(str_detect(keyword, '미국'), 'Y', 'N')) %>% \n    filter(keyword_detect =='Y') %>% \n    separate_rows(keyword, sep= \",\") %>% \n    rename(word = keyword) %>% \n    filter(str_length(word) > 1) %>% \n    count(president, word, sort = TRUE) %>% \n    group_by(president) %>%\n    mutate(row_number = row_number(),\n           word = reorder_within(word, n, president)) %>% \n    slice(1:20) %>% \n    ggplot(aes(x = word, y = n))+\n    geom_col(fill =\"#1f5c99\")+\n    coord_flip()+\n    scale_x_reordered()+\n    facet_wrap(~president, scales = \"free_y\", nrow = 1)+\n    theme(\n        text = element_text(family = 'Nanum Myeongjo'),\n        panel.grid.minor.x = element_blank(),\n        plot.title = element_text(size = 20),\n        #panel.grid.major.x = element_blank(),\n        #    panel.grid.major.y = element_blank(),\n        #axis.text.x = element_blank(),\n        axis.text.y = element_text(size = 12),\n        axis.ticks.x = element_blank(),\n        strip.text.x = element_text(size = 11),\n        legend.position = \"none\")+\n    labs(title = '미국이 들어간 칼럼만 추출한 결과',\n         y = '사설 수',\n         x = '날짜')\n```\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n########### 함수로 만들어서\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkeyword_top5<- c('기후변화', '미국', '한국', '우리나라', '중국', '배출량', \n                 '온실가스', '전문가', '가능성', '녹색성장', '코로나19',\n                 '창조경제', '탈원전')\n\n\nkeyword_top5\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"기후변화\" \"미국\"     \"한국\"     \"우리나라\" \"중국\"     \"배출량\"  \n [7] \"온실가스\" \"전문가\"   \"가능성\"   \"녹색성장\" \"코로나19\" \"창조경제\"\n[13] \"탈원전\"  \n```\n:::\n\n```{.r .cell-code}\nfor (i in keyword_top5) {\n    \n    keyword_top5_by_president = news.selected %>% \n        mutate(keyword_detect = ifelse(str_detect(keyword, i), 'Y', 'N')) %>% \n        filter(keyword_detect =='Y') %>% \n        separate_rows(keyword, sep= \",\") %>% \n        rename(word = keyword) %>% \n        filter(str_length(word) > 1) %>% \n        count(president, word, sort = TRUE) %>% \n        group_by(president) %>%\n        mutate(row_number = row_number(),\n               word = reorder_within(word, n, president)) %>% \n        slice(1:20) %>% \n        ggplot(aes(x = word, y = n))+\n        geom_col(fill =\"#1f5c99\")+\n        coord_flip()+\n        scale_x_reordered()+\n        facet_wrap(~president, scales = \"free_y\", nrow = 1)+\n        theme(\n            text = element_text(family = 'Nanum Myeongjo'),\n            panel.grid.minor.x = element_blank(),\n            plot.title = element_text(size = 20),\n            #panel.grid.major.x = element_blank(),\n            #    panel.grid.major.y = element_blank(),\n            #axis.text.x = element_blank(),\n            axis.text.y = element_text(size = 12),\n            axis.ticks.x = element_blank(),\n            strip.text.x = element_text(size = 11),\n            legend.position = \"none\")+\n        labs(title = paste('특정 키워드가 포함된 (키워드 :', i ,  ')칼럼만 추출하여 빈도 분석'),\n             y = '사설 수',\n             x = '날짜')\n    \n    \n    plot(keyword_top5_by_president)\n}\n```\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-9-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-9-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-9-4.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-9-5.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-9-6.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-9-7.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-9-8.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-9-9.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-9-10.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-9-11.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-9-12.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-9-13.png){width=672}\n:::\n:::\n\n\n## 정권별로 구분해서? - count로\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnews.keyword %>% \n    group_by(word) %>% \n    mutate(total = sum(n),\n           pct = round(n/total*100, 0)) %>% \n    #top_n(20) %>% \n    filter(n>=50) %>% \n    ggplot(aes(x = reorder(word, n, sum), y = n, fill = president))+\n    geom_col()+\n    coord_flip()+\n    theme(\n        text = element_text(family = 'Nanum Myeongjo'),\n        panel.grid.minor.x = element_blank(),\n        #panel.grid.major.x = element_blank(),\n        #    panel.grid.major.y = element_blank(),\n        axis.text.x = element_text(angle = 45, hjust = 1),\n        axis.text.y = element_text(size = 12),\n        axis.ticks.x = element_blank(),\n        strip.text.x = element_text(size = 11),\n        #legend.position = \"none\"\n    )+\n    labs(y = '단어 수',\n         x = '단어')\n```\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n### 정권별로 구분해서? - pct로\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnews.keyword %>% \n    group_by(president) %>% \n    mutate(total = sum(n)) %>% \n    ungroup() %>% \n    mutate(pct = n/total*100) %>% \n    #top_n(20) %>% \n    filter(pct >.4) %>% \n    ggplot(aes(x = reorder(word, pct, sum), y = pct, fill = president))+\n    geom_col()+\n    coord_flip()+\n    theme(\n        text = element_text(family = 'Nanum Myeongjo'),\n        panel.grid.minor.x = element_blank(),\n        #panel.grid.major.x = element_blank(),\n        #    panel.grid.major.y = element_blank(),\n        axis.text.x = element_text(angle = 45, hjust = 1),\n        axis.text.y = element_text(size = 12),\n        axis.ticks.x = element_blank(),\n        strip.text.x = element_text(size = 11),\n        #legend.position = \"none\"\n    )+\n    labs(\n        x = '단어')\n```\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n\n```{.r .cell-code}\nnews.keyword %>% \n    group_by(president) %>% \n    mutate(total = sum(n)) %>% \n    ungroup() %>% \n    mutate(pct = n/total*100) %>% \n    #top_n(20) %>% \n    filter(pct >.4) %>% \n    ggplot(aes(x = reorder(word, pct, sum), y = pct, fill = president))+\n    geom_col()+\n    coord_flip()+\n    theme(\n        text = element_text(family = 'Nanum Myeongjo'),\n        panel.grid.minor.x = element_blank(),\n        #panel.grid.major.x = element_blank(),\n        #    panel.grid.major.y = element_blank(),\n        axis.text.x = element_text(angle = 45, hjust = 1),\n        axis.text.y = element_text(size = 12),\n        axis.ticks.x = element_blank(),\n        strip.text.x = element_text(size = 11),\n        #legend.position = \"none\"\n    )+\n    labs(\n        x = '단어')\n```\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-11-2.png){width=672}\n:::\n:::\n\n\n## 네트워크 만들기\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggraph)\nlibrary(tidygraph)  ## 네트워크 그래프\nlibrary(widyr)   ##pairwise_count\n\n\n\n\n### 함수로 만들기 전에 원본?\n\nnews.keyword\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 25,607 × 3\n   president word         n\n   <fct>     <chr>    <int>\n 1 이명박    기후변화   542\n 2 박근혜    기후변화   309\n 3 문재인    기후변화   304\n 4 문재인    탄소중립   283\n 5 문재인    미국       250\n 6 문재인    한국       249\n 7 이명박    미국       232\n 8 문재인    탈원전     225\n 9 이명박    우리나라   204\n10 이명박    한국       199\n# ℹ 25,597 more rows\n```\n:::\n\n```{.r .cell-code}\nnews.selected%>% \n    select(keyword) %>% \n    rowid_to_column() %>%\n    separate_rows(keyword, sep= \",\") %>% \n    #  unnest_tokens(input = keyword,\n    #                output = word,\n    #                to_lower = FALSE) %>% \n    #  filter(str_length(word) > 1) %>%  \n    #  filter(!word %in% c('만큼', '그동안')) %>%  \n    pairwise_count(item = keyword,     ## pairwise_count  : 단어 동시 출현 빈도\n                   feature = rowid,\n                   sort = T) %>% \n    filter(n >= 30) %>%  ##\n    as_tbl_graph(directed = F) %>% \n    mutate(centrality = centrality_degree(),        # 연결 중심성 or centrality_edge_betweenness()  참고: https://tidygraph.data-imaginist.com/\n           group = as.factor(group_louvain()))  %>% \n    ggraph(layout = \"fr\") +      # 레이아웃\n    geom_edge_link(edge_color = \"gray50\",          # 엣지 색깔\n                   alpha = 0.2) +             # 엣지 명암\n    \n    geom_node_point(aes(size = centrality,    # 노드 크기\n                        color = group,\n                        alpha =0.5),       # 노드 색깔\n                    show.legend = F) +        # 범례 삭제\n    scale_size(range = c(3, 15)) +            # 노드 크기 범위\n    geom_node_text(aes(label = name),         # 텍스트 표시\n                   repel = T,                 # 노드밖 표시\n                   size = 5,                  # 텍스트 크기\n                   family = 'Nanum Myeongjo') +  # 폰트\n    \n    theme_graph()+                             # 배경 삭제\n    theme( text = element_text(family = 'Nanum Myeongjo'))\n```\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n## 연결중심성 pairwise_count : 단어 동시 출현 빈도 (filter \\>=50)\n\n\n::: {.cell}\n\n```{.r .cell-code}\npairwise_count_1<- news.selected%>% \n    select(keyword) %>% \n    rowid_to_column() %>% \n    unnest_tokens(input = keyword,\n                  output = word,\n                  to_lower = FALSE) %>% \n    filter(str_length(word) > 1) %>%  \n    pairwise_count(item = word,     ## pairwise_count  : 단어 동시 출현 빈도\n                   feature = rowid,\n                   sort = T) %>% \n    filter(n >=50) %>%  ##\n    as_tbl_graph(directed = F) %>% \n    mutate(centrality = centrality_degree(),        # 연결 중심성 or centrality_edge_betweenness()  참고: https://tidygraph.data-imaginist.com/\n           group = as.factor(group_louvain()))  %>% \n    ggraph(layout = \"fr\") +      # 레이아웃\n    geom_edge_link(edge_color = \"gray50\",          # 엣지 색깔\n                   alpha = 0.2) +             # 엣지 명암\n    \n    geom_node_point(aes(size = centrality,    # 노드 크기\n                        color = group,\n                        alpha =0.5),       # 노드 색깔\n                    show.legend = F) +        # 범례 삭제\n    scale_size(range = c(3, 15)) +            # 노드 크기 범위\n    geom_node_text(aes(label = name),         # 텍스트 표시\n                   repel = T,                 # 노드밖 표시\n                   size = 5,                  # 텍스트 크기\n                   family = \"nanumgothic\") +  # 폰트\n    \n    theme_graph()+                             # 배경 삭제\n    labs(title = \"1990-2023 신문 사설을 활용한 키워드 동시출현빈도 네트워크\")\n\n\npairwise_count_1\n```\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n\n# 전력자립도(지역) - 출처: KESIS \n\n\n## 라이브러리랑 데이터 가져오기\n데이터는 가져오면서 tidy 형태로 변환. 그리고 필요한 전처리\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readxl)\nlibrary(tidyverse)\nelec_independency_raw<-read_excel(\"전력자립도(지역).xlsx\", skip = 6) %>% \n  pivot_longer(-region, values_to = \"pct\", names_to =\"year\") %>% \n  mutate(year = as.numeric(year),\n         region = str_remove_all(region, \".(%).\"),\n         pct = if_else(pct == 0, NA, pct)) ##세종은 0으로 되어있어서 NA로 바꿈\n\n\n\nhead(elec_independency_raw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 3\n  region  year   pct\n  <chr>  <dbl> <dbl>\n1 서울    2011  2.86\n2 서울    2012  6.28\n3 서울    2013  4.69\n4 서울    2014  1.78\n5 서울    2015  1.65\n6 서울    2016  1.88\n```\n:::\n\n```{.r .cell-code}\nstr(elec_independency_raw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ntibble [170 × 3] (S3: tbl_df/tbl/data.frame)\n $ region: chr [1:170] \"서울\" \"서울\" \"서울\" \"서울\" ...\n $ year  : num [1:170] 2011 2012 2013 2014 2015 ...\n $ pct   : num [1:170] 2.86 6.28 4.69 1.78 1.65 ...\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nelec_independency_raw %>% \n  ggplot(aes(x = year, y = pct, group = region)) +\n  geom_line()\n```\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n\n```{.r .cell-code}\nelec_independency_raw %>% \n  filter(year==2020) %>% \n  arrange(desc(pct)) %>% pull(region) ->region_order\n\nregion_order\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"인천\" \"충남\" \"경북\" \"부산\" \"전남\" \"강원\" \"세종\" \"경남\" \"울산\" \"제주\"\n[11] \"전북\" \"경기\" \"대구\" \"서울\" \"충북\" \"광주\" \"대전\"\n```\n:::\n\n```{.r .cell-code}\nlibrary(gghighlight)\nelec_independency_raw %>% \n  ggplot(aes(x = year, y = pct, group = as.factor(region))) +\n  geom_line()+\n  gghighlight()+\n  facet_wrap(~fct_relevel(region, region_order))\n```\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-15-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nelec.independency.wider<-elec_independency_raw %>% \n    pivot_wider(names_from = year,\n                values_from = pct,\n                id_cols = region,\n                names_prefix = 'value_') %>% \n    select(region, value_2011, value_2020) \n\n\nelec.independency.wider\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 17 × 3\n   region value_2011 value_2020\n   <chr>       <dbl>      <dbl>\n 1 서울         2.86      11.2 \n 2 부산       288.       198.  \n 3 대구         1.31      17.4 \n 4 인천       305.       242.  \n 5 광주         0.45       7.15\n 6 대전         1.68       1.78\n 7 울산        37.9       89.9 \n 8 세종        NA        105.  \n 9 경기        24.1       58.2 \n10 강원        74.3      173.  \n11 충북         7.63       8.26\n12 충남       274.       226.  \n13 전북        33.5       61.3 \n14 전남       253.       188.  \n15 경북       161.       209.  \n16 경남       208.       104.  \n17 제주        75.7       71.1 \n```\n:::\n\n```{.r .cell-code}\nelec.independency.wider %>% \n    arrange(desc(value_2020)) %>% \n    mutate(y_position = rev(1:nrow(.))) %>% \n    select(region, y_position) ->y_position_elec\n\ny_position_elec\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 17 × 2\n   region y_position\n   <chr>       <int>\n 1 인천           17\n 2 충남           16\n 3 경북           15\n 4 부산           14\n 5 전남           13\n 6 강원           12\n 7 세종           11\n 8 경남           10\n 9 울산            9\n10 제주            8\n11 전북            7\n12 경기            6\n13 대구            5\n14 서울            4\n15 충북            3\n16 광주            2\n17 대전            1\n```\n:::\n\n```{.r .cell-code}\nelec_y_position <- left_join(elec.independency.wider, y_position_elec, by = 'region') %>% \n    arrange(y_position) %>% \n    mutate(bump_2011 = case_when(value_2011 < value_2020 ~ value_2011 -18, \n                                 value_2011 > value_2020 ~  value_2011 +18,\n                                 TRUE~NA_real_),\n           bump_2020 = case_when(value_2011 < value_2020 ~ value_2020 +18, \n                                 value_2011 > value_2020 ~  value_2020 -18,\n                                 TRUE~value_2020 + 10)) %>% \n    pivot_longer(-c('region', 'y_position'), \n                 names_to = c('.value', 'year'),\n                 names_sep = \"_\") %>% \n    mutate(value = round(value, 1),\n           bump = ifelse(region ==\"세종\", bump+10, bump))\n\nelec_y_position\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 34 × 5\n   region y_position year  value  bump\n   <chr>       <int> <chr> <dbl> <dbl>\n 1 대전            1 2011    1.7 -16.3\n 2 대전            1 2020    1.8  19.8\n 3 광주            2 2011    0.4 -17.6\n 4 광주            2 2020    7.2  25.2\n 5 충북            3 2011    7.6 -10.4\n 6 충북            3 2020    8.3  26.3\n 7 서울            4 2011    2.9 -15.1\n 8 서울            4 2020   11.2  29.2\n 9 대구            5 2011    1.3 -16.7\n10 대구            5 2020   17.4  35.4\n# ℹ 24 more rows\n```\n:::\n\n```{.r .cell-code}\narrow_data_elec<-elec_y_position %>% \n    pivot_wider(names_from = year, values_from = value,\n                id_cols = c(region, y_position),\n                names_prefix = 'year_') %>% \n    filter(abs(year_2011 - year_2020) >10) %>% \n    mutate(midpoint = (year_2011 + year_2020)/2) %>% \n    select(region, year_2011, midpoint, y_position) %>% \n    pivot_longer(-c('region', 'y_position'), names_to = \"type\", values_to = \"x\") %>% \n    mutate(x = ifelse(region %in% c('대구'), x +3, x),\n           x = ifelse(region %in% c('서울', '광주'), x +2, x))\n\n\narrow_data_elec\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 22 × 4\n   region y_position type          x\n   <chr>       <int> <chr>     <dbl>\n 1 대구            5 year_2011   4.3\n 2 대구            5 midpoint   12.4\n 3 경기            6 year_2011  24.1\n 4 경기            6 midpoint   41.1\n 5 전북            7 year_2011  33.5\n 6 전북            7 midpoint   47.4\n 7 울산            9 year_2011  37.9\n 8 울산            9 midpoint   63.9\n 9 경남           10 year_2011 208. \n10 경남           10 midpoint  156. \n# ℹ 12 more rows\n```\n:::\n\n```{.r .cell-code}\nlibrary(shadowtext)\nlibrary(ggtext)\nlibrary(showtext)\nshowtext_auto()\nfont_add_google('Nanum Myeongjo', 'Nanum Myeongjo')\n\n\nelec_y_position %>%\n    ggplot(aes(x = value, y = y_position, color = year, group = y_position))+\n    geom_vline(xintercept = 100, linetype =\"dotted\", color = \"blue\")+\n    \n    geom_line( color =\"#142f38\", linewidth = 1.5)+\n    geom_point(size = 3)+\n    geom_path(data = arrow_data_elec, aes(x = x, y = y_position, group = y_position),\n              color = '#142f38',\n              arrow = arrow(angle = 30, length = unit(0.1, 'inch')))+\n    scale_color_manual(values =  c('#142f38', '#4ea267'),\n                       #c('#727272', '#15607a'),\n                       label = c('2011년', '2020년')\n    )+\n    scale_x_continuous(labels = function(x) paste0(x, \"%\"))+\n    scale_y_continuous(breaks = c(elec_y_position$y_position, 1,elec_y_position$y_position+1),\n                       labels = c(elec_y_position$region, rep(\"\", length(elec_y_position$y_position)+1)))+\n    geom_shadowtext(aes(label = value, x = bump, \n                        #  y = y_position -.4\n    ),\n    bg.colour='white', size = 4)+\n    theme_bw()+\n    theme_minimal()+\n    guides(color = guide_legend(\"연도\"))+\n    theme(text = element_text(family = 'Nanum Myeongjo',\n                              size = 14),\n          plot.title = element_text(size= 20, face=\"bold\"),\n          plot.subtitle = element_markdown(size= 14,lineheight = 1.2),\n          axis.text.x = element_text(size = 14),\n          axis.text.y = element_text(size = 14),\n          axis.title.x =element_text(size = 14),\n          panel.grid.minor.x = element_blank(),\n          #panel.grid.major.y = element_blank(),\n          panel.grid.major.x = element_blank(),\n          panel.grid.minor.y = element_blank(),\n          plot.title.position = \"plot\",\n          legend.position = \"top\"\n    )+\n    labs(title = \"대한민국 17개 광역지자체별 전력자립도 변화\",\n         subtitle =\"전력자립도는 전략 발전량을 소비량으로 나눈 백분율로, <br> <span style='color:#142f38'>**2011년**</span>과 <span style ='color:#4ea267'>2020년</span> 대한민국 광역지자체별 전력자립도 변화를 <br>덤벨차트를 활용하여 나타내었으며, 2020년 기준 내림차순으로 정렬\",\n         y = \"\",\n         x = \"전력자립도\",\n         caption = \"Source : KESIS(국가에너지통계 정보시스템),\\nGraphic : Jiseok\")\n```\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"KESIS_elec_independency.png\",  width= 550, height = 800, units =\"px\", dpi = 100)\n\n\n\n\nelec_independency_raw %>% \n    ggplot(aes(x= as.numeric(year), y = pct, \n               #color = region, \n               group = region))+\n    geom_line(data = . %>% filter(region %in% c('인천', '충남', '부산', '전남', '경남')), color =\"red\")+\n    geom_line(data = . %>% filter(region %in% c('울산', '전북', '경기', '강원', '경북')), color =\"blue\")+\n    geom_text(data = . %>% filter(year == 2020), aes(label =region),  hjust = -1, family = 'Nanum Myeongjo')+\n    scale_x_continuous(limits = c(2011, 2021), breaks =seq(2011, 2020, 1))+\n    theme_bw()+\n    theme_minimal()+\n    theme(text = element_text(family = 'Nanum Myeongjo',\n                              size = 14),\n          plot.title = element_text(size= 20, face=\"bold\"),\n          plot.subtitle = element_markdown(size= 16,lineheight = 1.2),\n          axis.text.x = element_text(size = 14),\n          axis.text.y = element_text(size = 14),\n          axis.title.x =element_text(size = 14),\n          panel.grid.minor.x = element_blank(),\n          #panel.grid.major.y = element_blank(),\n          panel.grid.major.x = element_blank(),\n          panel.grid.minor.y = element_blank(),\n          plot.title.position = \"plot\",\n          legend.position = \"none\"\n    )+\n    labs(title = \"2011-2020, 시도별 전력자립도\",\n         subtitle =\"<span style='color:#142f38'>**2011년**</span>과 <span style ='color:#4ea267'>2020년</span>, 지자체별 전력자립도\",\n         y = \"\",\n         x = \"전력자립도\",\n         caption = \"Source : KESIS(국가에너지통계 정보시스템),\\nGraphic : Jiseok\")\n```\n\n::: {.cell-output-display}\n![](project_with_code_files/figure-html/unnamed-chunk-16-2.png){width=672}\n:::\n:::\n\n\n![](KESIS_elec_independency_facet.png)\n\n",
    "supporting": [
      "project_with_code_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}